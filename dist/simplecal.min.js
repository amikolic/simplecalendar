!function($,s,m){"use strict";function e(t,e){this.options=$.extend({},$.simplecal.defaults,e),this.$input=$(t),this.init()}var i=s.app&&s.app.$window||$(s),n=s.app&&s.app.$document||$(m),g=s.app&&s.app.$body||$("body"),c=0,u=Array.prototype.slice,r="scDate-",v=/,|\.|-| |\/|\\/,p=/d/gi,l=/m/gi,h=/y/gi,o=function(s,t){var e={};return t||(t=function(t){return t}),function(){var i=t.apply(this,arguments);return Object.prototype.hasOwnProperty.call(e,i)?e[i]:e[i]=s.apply(this,arguments)}},t=o(function(t,e){return t.toString().length>e?t:new Array(e-t.toString().length+1).join("0")+t},function(t,e){return t+":"+e}),a=function(t,e){return new Date(e,t,0).getDate()},f=function(t){var e=new Date(t.year,t.month-1,t.day);return e&&e.getMonth()+1===t.month&&e.getDate()===Number(t.day)},y=o(function(o,a){var n=a.match(v)[0],e={},s=o.split(n),i=a.split(n);if(3!==s.length||3!==i.length)return!1;for(var t=0;3>t;t++)i[t].match(p)?e.day=parseInt(s[t],10):i[t].match(l)?e.month=parseInt(s[t],10):i[t].match(h)&&(e.year=parseInt(s[t],10));return f(e)?e:!1},function(t,e){return t+":"+e}),d=o(function(s,i,a,n){var e=n;return e=e.replace(/d+/i,t(s,e.match(p).length)),e=e.replace(/m+/i,t(i,e.match(l).length)),e=e.replace(/y+/i,t(a,e.match(h).length))},function(){return u.call(arguments,0).join(":")});e.getDateVars=function(t,e){return t instanceof Date?{day:t.getDate(),month:t.getMonth()+1,year:t.getFullYear()}:(e||(e=this.options.dateFormat),y(t,e))},e.formatDate=function(t,e){return t instanceof Date&&(t={day:t.getDate(),month:t.getMonth()+1,year:t.getFullYear()}),e||(e=this.options.dateFormat),d(t.day,t.month,t.year,e)},e.getHtml=function(i,e){i=parseInt(i,10),e=parseInt(e,10);var n=new Date(e,i-1,1).getDay();0===n&&(n=7);var f=new Date(e,i,1),m=new Date(e,i-2,1),C=f.getMonth()+1,w=f.getFullYear(),y=m.getMonth()+1,D=m.getFullYear(),o="<tr>",d=0,v=a(i,e),l=1;d=1>i-1?a(12,e-1):a(i-1,e);for(var c=1;n>c;c++)o+='<td><span class="'+this.options.cellDisabledClass+'">'+(d-n+c+1)+"</span></td>";for(;v>=l;){n>7&&(o+="</tr><tr>",n=1);var g=t(l,2)+"-"+t(i,2)+"-"+t(e,4);o+='<td><a class="'+this.options.cellClass+" "+r+g+'" data-date="'+g+'">'+l+"</a></td>",n++,l++}for(var s=1;8>n;)o+='<td><span class="'+this.options.cellDisabledClass+'">'+s++ +"</span></td>",n++;o+="</tr>";var p=this.options.months[i-1],h=e;if(this.options.changeMonth){p='<select class="'+this.options.monthSelectClass+'">';for(var s=0;12>s;s++)p+='<option data-to-year="'+e+'" value="'+(s+1)+'" '+(i-1===s?' selected="selected"':"")+">"+this.options.months[s]+"</option>";p+="</select>"}if(this.options.changeYear){h='<select class="'+this.options.yearSelectClass+'">';for(var s=100;s>0;s--)h+='<option value="'+(e-s)+'">'+(e-s)+"</option>";h+='<option selected="selected" value="'+e+'">'+e+"</option>";for(var s=1;100>s;s++)h+='<option value="'+(e+s)+'">'+(e+s)+"</option>";h+="</select>"}var u='<div class="meta"><p class="meta_title"><span class="month">'+p+'</span> <span class="year">'+h+'</span></p><a data-to-month="'+y+'" data-to-year="'+D+'" data-current-month="'+i+'" data-current-year="'+e+'" class="'+this.options.monthChangeClass+" "+this.options.prevMonthClass+'"><span>'+this.options.prevMonthText+'</span></a><a data-to-month="'+C+'" data-to-year="'+w+'" data-current-month="'+i+'" data-current-year="'+e+'" class="'+this.options.monthChangeClass+" "+this.options.nextMonthClass+'"><span>'+this.options.nextMonthText+"</span></a></div><table><thead><th>"+this.options.days[0]+"</th><th>"+this.options.days[1]+"</th><th>"+this.options.days[2]+"</th><th>"+this.options.days[3]+"</th><th>"+this.options.days[4]+"</th><th>"+this.options.days[5]+"</th><th>"+this.options.days[6]+"</th></thead><tbody>"+o+"</tbody></table>";return this.options.todayButton&&(u+='<button class="'+this.options.todayButtonClass+'">'+this.options.todayButtonText+"</button>"),u},$.extend(e.prototype,{init:function(){this.$el=$("<div>").addClass(this.options.calendarClass),this.$calEl=$("<div>").addClass(this.options.calendarClass+"Inner").appendTo(this.$el),this.opened=!1,this.ens=".simplecal"+ ++c,this.inputDateValBackup=this.getInputDateVal(),this.$input.data("class")&&this.$el.addClass(this.$input.data("class")),this.$input.data("date-format")&&(this.options.dateFormat=this.$input.data("date-format")),this.$input.data("time-step")&&(this.options.timeStep=parseInt(this.$input.data("time-step"),10)),this.$input.data("change-month")&&(this.options.changeMonth=!0),this.$input.data("change-year")&&(this.options.changeYear=!0),"undefined"!=typeof this.$input.data("show-seconds")&&(this.options.showSeconds=!!this.$input.data("show-seconds")),this.options.attached&&(this.showCalendar(),this.$el.addClass(this.options.attachedClass)),this.options.mobileBreakpoint&&i.outerWidth()<=this.options.mobileBreakpoint&&this.setReadonly(!0),this.options.timepicker&&this.setupTimePicker(),this.events()},getInputDateVal:function(){var t=this.$input.val();return t.length?this.options.timepicker?t.split(" ")[0]:t:""},setInputDateVal:function(t){return this.$input.val(this.options.timepicker?t+" "+this.formatTime(parseInt(this.$inputTime.val(),10)):t),this},getInputTimeVal:function(){var t=this.$input.val();return 0!==t.length?t.split(" ")[1]:this.formatTime(0)},setInputTimeVal:function(t){return this.$input.val(this.$input.val().split(" ")[0]+" "+t),this},events:function(){var t="."+this.options.cellClass.split(" ").join("."),e="."+this.options.monthChangeClass.split(" ").join(".");this.$input.on("focus"+this.ens+" click"+this.ens,$.proxy(this.onFocus,this)).on("change"+this.ens,$.proxy(this.setupMarkers,this)).on("keyup"+this.ens,$.proxy(this.onKeyup,this)),this.$el.on("click"+this.ens,t,$.proxy(this.onSelectDate,this)),this.$el.on("click"+this.ens,e,$.proxy(this.onChangeMonth,this)),this.options.changeMonth&&this.$el.on("change"+this.ens,"."+this.options.monthSelectClass.split(" ").join("."),$.proxy(this.onMonthSelect,this)),this.options.changeYear&&this.$el.on("change"+this.ens,"."+this.options.yearSelectClass.split(" ").join("."),$.proxy(this.onYearSelect,this)),this.options.todayButton&&this.$el.on("click"+this.ens,"."+this.options.todayButtonClass.split(" ").join("."),$.proxy(this.onClickTodayButton,this)),this.$el.on("show",$.proxy(this.onShow,this)),this.$el.on("close",$.proxy(this.onClose,this))},onFocus:function(){this.validateInput()&&this.showCalendar()},onKeyup:function(e){if(!($.inArray(e.keyCode,[37,38,39,40,16,27])>=0)&&this.validateInput()){var t=this.getDateVars(0===this.getInputDateVal().length?new Date:this.getInputDateVal());this.$calEl.html(this.getCalendarHtml(t.month,t.year)),this.setupMarkers()}},onSelectDate:function(t){var e=this.formatDate(this.getDateVars($(t.target).data("date"),"dd-mm-yyyy"));this.setInputDateVal(e).$input.trigger("change"),this.options.attached||this.close()},onChangeMonth:function(e){var t=$(e.currentTarget);return this.$calEl.html(this.getCalendarHtml(t.data("to-month"),t.data("to-year"))),this.setupMarkers(),this.options.attached||this.setupPosition(),!1},onMonthSelect:function(e){var s=$(e.currentTarget),t=s.find(":selected");return this.$calEl.html(this.getCalendarHtml(t.val(),t.data("to-year"))),this.setupMarkers(),this.options.attached||this.setupPosition(),!1},onYearSelect:function(t){var e=$(t.currentTarget),s=e.find(":selected");return this.$calEl.html(this.getCalendarHtml(1,s.val())),this.setupMarkers(),this.options.attached||this.setupPosition(),!1},onClickTodayButton:function(t){t.preventDefault(),this.setDate(new Date,this.options.format)},onShow:function(){var t=this;this.$input.addClass(this.options.inputActiveClass),t.options.attached||(i.on("resize"+this.ens,function(){t.setupPosition()}),n.on("click"+this.ens+" focusout"+this.ens+" keyup"+this.ens,function(e){return 27===e.keyCode&&t.opened?void t.close():void(!$(e.target).is(t.$input)&&!$.contains(t.$el[0],e.target)&&t.close())}))},onClose:function(){this.$input.removeClass(this.options.inputActiveClass),n.off(this.ens),i.off(this.ens)},setReadonly:function(t){this.$input[0].readOnly=t},validateInput:function(){var t=this.getInputDateVal();return 0===t.length||this.getDateVars(t)?(this.$input.removeClass(this.options.calendarClass+"_invalid"),this.inputDateValBackup=t,!0):(this.$input.addClass(this.options.calendarClass+"_invalid"),this.options.disableInvalidInput&&this.setInputDateVal(this.inputDateValBackup),!1)},showCalendar:function(){if(!this.opened){this.opened=!0;var t=this.getDateVars(0===this.getInputDateVal().length?new Date:this.getInputDateVal());this.$calEl.html(this.getCalendarHtml(t.month,t.year)),this.setupMarkers(),this.options.attached?this.$attachCont||(this.$attachCont="string"==typeof this.options.attached?this.$input.closest(this.options.attached):this.$input.parent(),this.$el.appendTo(this.$attachCont)):(this.$el.appendTo(g),this.setupPosition(),this.$el.trigger("show"))}},close:function(){this.opened&&(this.opened=!1,this.$el.detach().trigger("close"))},setupMarkers:function(){this.$el.find("."+this.options.dateActiveClass).removeClass(this.options.dateActiveClass);var e=function(e){return"."+r+t(e.day,2)+"-"+t(e.month,2)+"-"+t(e.year,4)};this.$el.find(e(this.getDateVars(new Date))).addClass(this.options.dateTodayClass),this.getInputDateVal().length&&this.$el.find(e(this.getDateVars(this.getInputDateVal()))).addClass(this.options.dateActiveClass)},setupPosition:function(){var h=i.outerHeight(),a=i.outerWidth(),t=this.$input.offset(),s=this.$input.outerHeight(),l=this.$input.outerWidth();if(this.options.mobileBreakpoint&&a<=this.options.mobileBreakpoint)return this.setReadonly(!0),void this.$el.attr("style","").addClass(this.options.calendarMobileClass).css({top:t.top+s});this.$el.removeClass(this.options.calendarClass+"_mobile");var n=this.$el.outerWidth(),o=this.$el.outerHeight(),e={};n+t.left>a?(e.left=t.left-(n-l),e.top=t.top+s):o+t.top+s>h+i.scrollTop()?(e.left=t.left,e.top=t.top-o):e={left:t.left,top:t.top+s},this.$el.css(e)},incrementDate:function(e){var t=this.getDateVars(this.getInputDateVal()),s=new Date(t.year,t.month-1,t.day);return this.setDate(new Date(s.getTime()+864e5*e))},setDate:function(t,e){return this.setInputDateVal(this.formatDate(this.getDateVars(t,e))).$input.trigger("change"),this},setupTimePicker:function(){this.$timeEl=$("<div>").addClass(this.options.timeElClass).appendTo(this.$el),this.$timePreview=$("<div>").addClass(this.options.timePreviewClass).appendTo(this.$timeEl);var t=this.getInputTimeVal(),e=t.length?this.parseTime(t):0;this.$inputTime=$("<input>").val(e).appendTo(this.$timeEl).simpleRangeSlider($.extend({maxVal:86399,step:this.options.timeStep,onUpdateView:$.proxy(function(e){var t=this.formatTime(parseInt(e,10));this.$timePreview.text(t),0!==this.$input.val().length&&this.setInputTimeVal(t)},this)},this.options.rangeSliderOptions)).on("change",$.proxy(function(){this.$input.trigger("change")},this)),this.rangeSliderApi=this.$inputTime.data("simpleRangeSlider")},formatTime:function(e){var s=Math.floor(e/3600),i=Math.floor((e-60*s*60)/60),a=e-60*s*60-60*i;return t(s,2)+":"+t(i,2)+(this.options.showSeconds?":"+t(a,2):"")},parseTime:function(e){var t=0;return $.each(e.split(":"),function(e,s){t+=Math.pow(60,2-e)*s}),t},destroy:function(){this.$input.off(this.ens).removeClass(this.options.inputActiveClass),i.off(this.ens),n.off(this.ens),this.rangeSliderApi&&this.rangeSliderApi.destroy(),this.$el.empty().remove(),delete this.$el.data().simplecal},getDateVars:e.getDateVars,getCalendarHtml:e.getHtml,formatDate:e.formatDate}),$.fn.simplecal=function(t){return this.each(function(){$.data(this,"simplecal")||$.data(this,"simplecal",new e(this,t))})},$.simplecal=e,$.simplecal.defaults={dateFormat:"dd.mm.yyyy",attached:!1,mobileBreakpoint:null,disableInvalidInput:!1,calendarClass:"simplecal",calendarMobileClass:"simplecal_mobile",cellClass:"simplecal_cell",cellDisabledClass:"simplecal_disabled",inputActiveClass:"active",attachedClass:"attached",dateActiveClass:"selected",dateTodayClass:"today",monthChangeClass:"month_control",nextMonthClass:"next",prevMonthClass:"prev",monthSelectClass:"sc_month_select",yearSelectClass:"sc_year_select",changeMonth:!1,changeYear:!1,todayButton:!1,todayButtonClass:"todayBtn",todayButtonText:"Today",timepicker:!1,timeElClass:"simplecal_time",timePreviewClass:"simplecal_time_preview",timeStep:300,showSeconds:!0,rangeSliderOptions:{},prevMonthText:"Previous month",nextMonthText:"Next month",months:["January","February","March","April","May","June","July","August","September","October","November","December"],days:["Mo","Tu","We","Th","Fr","Sa","Su"]}}(window.jQuery||window.Zepto,window,document);