!function(t,s,v){"use strict";function e(e,a){this.options=t.extend({},t.simplecal.defaults,a),this.input=e,this.$input=t(e),this.options.disableWhenTouch&&m&&"date"===this.$input.attr("type")||this.init()}var n=s.app&&s.app.$window||t(s),h=s.app&&s.app.$document||t(v),f=s.app&&s.app.$body||t("body"),m=!!("ontouchstart"in s)||!!("onmsgesturechange"in s),_=0,d=Array.prototype.slice,c="scDate-",u=/,|\.|-| |\/|\\/,p=/d/gi,l=/m/gi,r=/y/gi,i=function(a,t){var e={};return t||(t=function(t){return t}),function(){var s=t.apply(this,arguments);return Object.prototype.hasOwnProperty.call(e,s)?e[s]:e[s]=a.apply(this,arguments)}},a=i(function(t,e){return t.toString().length>e?t:new Array(e-t.toString().length+1).join("0")+t},function(t,e){return t+":"+e}),o=function(t,e){return new Date(e,t,0).getDate()},g=function(t){var e=new Date(t.year,t.month-1,t.day);return e&&e.getMonth()+1===t.month&&e.getDate()===Number(t.day)},y=i(function(o,n){var i=n.match(u)[0],e={},a=o.split(i),s=n.split(i);if(3!==a.length||3!==s.length)return!1;for(var t=0;3>t;t++)s[t].match(p)?e.day=parseInt(a[t],10):s[t].match(l)?e.month=parseInt(a[t],10):s[t].match(r)&&(e.year=parseInt(a[t],10));return g(e)?e:!1},function(t,e){return t+":"+e}),$=i(function(e,s,n,i){var t=i;return t=t.replace(/d+/i,a(e,t.match(p).length)),t=t.replace(/m+/i,a(s,t.match(l).length)),t=t.replace(/y+/i,a(n,t.match(r).length))},function(){return d.call(arguments,0).join(":")});e.getDateVars=function(t,e){return t instanceof Date?{day:t.getDate(),month:t.getMonth()+1,year:t.getFullYear()}:(e||(e=this.options.dateFormat),y(t,e))},e.formatDate=function(t,e){return t instanceof Date&&(t={day:t.getDate(),month:t.getMonth()+1,year:t.getFullYear()}),e||(e=this.options.dateFormat),$(t.day,t.month,t.year,e)},e.getHtml=i(function(t,e){var s=new Date(e,t-1,1).getDay();0===s&&(s=7);var r=new Date(e,t,1),l=new Date(e,t-2,1),v=r.getMonth()+1,d=r.getFullYear(),m=l.getMonth()+1,y=l.getFullYear(),n="<tr>",p=0,_=o(t,e),i=1;p=1>t-1?o(12,e-1):o(t-1,e);for(var h=1;s>h;h++)n+='<td><span class="'+this.options.calendar_class+'_disabled">'+(p-s+h+1)+"</span></td>";for(;_>=i;){s>7&&(n+="</tr><tr>",s=1);var u=a(i,2)+"-"+a(t,2)+"-"+a(e,4);n+='<td><a class="'+this.options.calendar_class+"_cell "+c+u+'" data-date="'+u+'">'+i+"</a></td>",s++,i++}for(var g=1;8>s;)n+='<td><span class="'+this.options.calendar_class+'_disabled">'+g++ +"</span></td>",s++;n+="</tr>";var f='<div class="meta"><p class="meta_title"><span>'+this.options.months[t-1]+" "+e+'</span></p><a data-to-month="'+m+'" data-to-year="'+y+'" data-current-month="'+t+'" data-current-year="'+e+'" class="'+this.options.month_change_class+" "+this.options.prev_month_class+'"><span>'+this.options.prev_month_text+'</span></a><a data-to-month="'+v+'" data-to-year="'+d+'" data-current-month="'+t+'" data-current-year="'+e+'" class="'+this.options.month_change_class+" "+this.options.next_month_class+'"><span>'+this.options.next_month_text+"</span></a></div><table><thead><th>"+this.options.days[0]+"</th><th>"+this.options.days[1]+"</th><th>"+this.options.days[2]+"</th><th>"+this.options.days[3]+"</th><th>"+this.options.days[4]+"</th><th>"+this.options.days[5]+"</th><th>"+this.options.days[6]+"</th></thead><tbody>"+n+"</tbody></table>";return f},function(t,e){return t+":"+e}),e.prototype={init:function(){this.$el=t('<div class="'+this.options.calendar_class+'" />'),this.$input.data("class")&&this.$el.addClass(this.$input.data("class")),this.opened=!1,this.event_namespace=".simplecal"+ ++_,this.input_val_backup=this.$input.val(),this.options.attached&&(this.show_calendar(),this.$el.addClass("attached")),this.options.mobile_breakpoint&&n.outerWidth()<=this.options.mobile_breakpoint&&this.set_readonly(!0),this.events()},events:function(){var e=this;this.$input.on("focus click",function(t){e.on_focus(t)}).on("change",function(t){e.setupMarkers(t)}).on("keyup",function(t){e.on_keyup(t)}),this.$el.on("click","."+this.options.calendar_class+"_cell",function(t){e.on_select_date(t,this)}),this.$el.on("click","."+this.options.month_change_class,function(a){return e.on_change_month(a,t(this)),!1}),this.$el.on("show",function(){e.on_show()}),this.$el.on("close",function(){e.on_close()})},on_focus:function(){this.validate_input()&&this.show_calendar()},on_keyup:function(a){if(!(t.inArray(a.keyCode,[37,38,39,40,16,27])>=0)&&this.validate_input()){var e=this.getDateVars(0===this.$input.val().length?new Date:this.$input.val());this.$el.html(this.generate_calendar_html(e.month,e.year)),this.setupMarkers()}},on_select_date:function(s,e){var a=this.formatDate(this.getDateVars(t(e).data("date"),"dd-mm-yyyy"));this.$input.val(a).trigger("change"),this.options.attached||this.close()},on_change_month:function(e,t){this.$el.html(this.generate_calendar_html(t.data("to-month"),t.data("to-year"))),this.setupMarkers(),this.options.attached||this.setup_position()},on_show:function(){var e=this;this.$input.addClass(this.options.input_active_class),n.on("resize"+this.event_namespace,function(){e.options.attached||e.setup_position()}),h.on("click"+this.event_namespace+" focusout"+this.event_namespace+" keyup"+this.event_namespace,function(a){if(a.keyCode&&27===a.keyCode&&e.opened)return void e.close();var s=t(a.target);s.is(e.$input)||s.is(e.$el)||s.parents().is(e.$el)||e.close()})},on_close:function(){this.$input.removeClass(this.options.input_active_class),h.off(this.event_namespace),n.off(this.event_namespace)},set_readonly:function(t){this.input.readOnly=t?!0:!1},validate_input:function(){var t=this.$input.val();return 0===t.length||this.getDateVars(t)?(this.$input.removeClass(this.options.calendar_class+"_invalid"),this.input_val_backup=t,!0):(this.$input.addClass(this.options.calendar_class+"_invalid"),this.options.disableInvalidInput&&this.$input.val(this.input_val_backup),!1)},show_calendar:function(){if(!this.opened){this.opened=!0;var t=this.getDateVars(0===this.$input.val().length?new Date:this.$input.val());if(this.$el.html(this.generate_calendar_html(t.month,t.year)),this.setupMarkers(),this.options.attached){if(this.$attach_cont)return;this.$attach_cont="string"==typeof this.options.attached?this.$input.closest(this.options.attached):this.$input.parent(),this.$el.appendTo(this.$attach_cont)}else this.$el.appendTo(f),this.setup_position(),this.$el.trigger("show")}},close:function(){this.opened&&(this.opened=!1,this.$el.detach().trigger("close"))},setupMarkers:function(){this.$el.find("."+this.options.date_active_class).removeClass(this.options.date_active_class);var t=function(t){return"."+c+a(t.day,2)+"-"+a(t.month,2)+"-"+a(t.year,4)};this.$el.find(t(this.getDateVars(new Date))).addClass(this.options.date_today_class),this.$input.val().length&&this.$el.find(t(this.getDateVars(this.$input.val()))).addClass(this.options.date_active_class)},setup_position:function(){var h=n.outerHeight(),s=n.outerWidth(),t=this.$input.offset(),a=this.$input.outerHeight(),r=this.$input.outerWidth();if(this.options.mobile_breakpoint&&s<=this.options.mobile_breakpoint)return this.set_readonly(!0),void this.$el.attr("style","").addClass(this.options.calendar_class+"_mobile").css({top:t.top+a});this.$el.removeClass(this.options.calendar_class+"_mobile");var i=this.$el.outerWidth(),o=this.$el.outerHeight(),e={};i+t.left>s?(e.left=t.left-(i-r),e.top=t.top+a):o+t.top>h?(e.left=t.left,e.top=t.top-o):e={left:t.left,top:t.top+a},this.$el.css(e)},increment_date:function(e){var t=this.getDateVars(this.$input.val()),a=new Date(t.year,t.month-1,t.day);return this.set_date(new Date(a.getTime()+864e5*e))},set_date:function(t,e){return this.$input.val(this.formatDate(this.getDateVars(t,e))).trigger("change"),this},getDateVars:e.getDateVars,generate_calendar_html:e.getHtml,formatDate:e.formatDate},t.fn.simplecal=function(a){return this.each(function(){t.data(this,"simplecal")||t.data(this,"simplecal",new e(this,a))})},t.simplecal=e,t.simplecal.defaults={dateFormat:"dd.mm.yyyy",attached:!1,disableWhenTouch:!1,mobile_breakpoint:null,disableInvalidInput:!1,max_date:null,min_date:null,calendar_class:"simplecal",input_active_class:"active",date_active_class:"selected",date_today_class:"today",month_change_class:"month_control",next_month_class:"next",prev_month_class:"prev",prev_month_text:"Previous month",next_month_text:"Next month",months:["January","February","March","April","May","June","July","August","September","October","November","December"],days:["Mo","Tu","We","Th","Fr","Sa","Su"]}}(window.jQuery||window.Zepto,window,document);